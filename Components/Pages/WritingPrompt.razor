@page "/writing-prompt"
@rendermode InteractiveServer

@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.EntityFrameworkCore
@using mass.Data

@inject MassDbContext DbContext
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Writing Prompt</PageTitle>

<h1>Writing Prompt</h1>

@if (prompt == null)
{
    <div class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}
else if (prompt.Id == 0)
{
    <div class="alert alert-info" role="alert">
        <p>We don't have any writing prompts yet, but check back soon!</p>
    </div>
}
else
{
    <p>Here's a writing prompt we've curated just for you. Use it to spark your creativity!</p>

    <div class="bg-light p-4 rounded mb-4 border-start border-primary border-4">
        <p class="mb-0">@prompt.PromptText</p>
    </div>

    <p>Ready to write? Head to your stories to start a new chapter with this prompt.</p>

    <div>
        <a href="/stories" class="btn btn-primary">Start Writing</a>
        <button class="btn btn-outline-secondary ms-2" @onclick="LoadNewPrompt">Get Another Prompt</button>
    </div>
}

@code {
    private mass.Data.WritingPrompt? prompt;

    protected override async Task OnInitializedAsync()
    {
        await LoadNewPrompt();
    }

    private async Task LoadNewPrompt()
    {
        prompt = await DbContext.WritingPrompts
            .OrderBy(p => EF.Functions.Random())
            .FirstOrDefaultAsync();
        
        if (prompt == null)
        {
            prompt = new mass.Data.WritingPrompt { Id = 0, PromptText = "" };
        }
    }
}
